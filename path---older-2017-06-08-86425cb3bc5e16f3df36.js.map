{"version":3,"sources":["webpack:///path---older-2017-06-08-86425cb3bc5e16f3df36.js","webpack:///./.cache/json/older-2017-06-08.json"],"names":["webpackJsonp","463","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","pathContext","slug","previous","fields","next"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,gBAAAC,OAAA,aAA6CC,gBAAmBC,GAAA,+GAAAC,KAAA,smeAAusfC,aAA2KL,MAAA,eAAAM,KAAA,mBAAgDC,aAAgBC,KAAA,qBAAAC,UAAwCC,QAAUF,KAAA,sBAA4BH,aAAgBL,MAAA,UAAiBW,MAASD,QAAUF,KAAA,sBAA4BH,aAAgBL,MAAA","file":"path---older-2017-06-08-86425cb3bc5e16f3df36.js","sourcesContent":["webpackJsonp([139262494466065],{\n\n/***/ 463:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"DeepCold Blog\",\"author\":\"DeepCold\"}},\"markdownRemark\":{\"id\":\"/Users/80253170/iserver/deepcoldy.github.io/src/pages/older/2017-06-08.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>本文章只针对Vue2.3版本，后续源码和api都可能产生变化，阅读时请因地制宜。</p>\\n<h2>入口文件</h2>\\n<p>Vue 2.3的入口文件叫做runtime-with-compiler.js (此文件名可能会随着版本变化)</p>\\n<p><img src=\\\"https://raw.githubusercontent.com/deepcoldy/pic/master/20190727231750.png\\\"></p>\\n<h3>流程图</h3>\\n<p><img src=\\\"https://raw.githubusercontent.com/deepcoldy/pic/master/20190727231804.png\\\"></p>\\n<h3>文件关联</h3>\\n<p><code class=\\\"language-text\\\">src/core/instance/init.js</code> 引入 <code class=\\\"language-text\\\">src/core/instance/inject.js</code>  引入 <code class=\\\"language-text\\\">src/core/observer/index.js</code>\\nobserver的index.js\\n<code class=\\\"language-text\\\">src/core/instance/index.js</code> 和 <code class=\\\"language-text\\\">src/core/instance/init.js</code> 都引入了 <code class=\\\"language-text\\\">src/core/instance/state.js</code>。\\nstate.js是给 data 对象添加 Observer 的。\\n<code class=\\\"language-text\\\">src/core/instance/init.js</code> 中调用了 state.js 的 initState 方法</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// src/core/instance/init.js</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">initState</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">vm<span class=\\\"token punctuation\\\">:</span> Component</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  vm<span class=\\\"token punctuation\\\">.</span>_watchers <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token keyword\\\">const</span> opts <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initProps</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>methods<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initMethods</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>methods<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">initData</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">)</span>  <span class=\\\"token comment\\\">// 给 data 对象添加 Observer </span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">observe</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">.</span>_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token comment\\\">/* asRootData */</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>computed<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initComputed</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>computed<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>watch<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initWatch</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>watch<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>最重要的就是initDate()的方法</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// src/core/instance/init.js</span>\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">initData</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">vm<span class=\\\"token punctuation\\\">:</span> Component</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> data <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options<span class=\\\"token punctuation\\\">.</span>data\\n  data <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">typeof</span> data <span class=\\\"token operator\\\">===</span> <span class=\\\"token string\\\">'function'</span>\\n    <span class=\\\"token operator\\\">?</span> <span class=\\\"token function\\\">getData</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">,</span> vm<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">:</span> data <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isPlainObject</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n    process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">NODE_ENV</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">'production'</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">warn</span><span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">'data functions should return an object:\\\\n'</span> <span class=\\\"token operator\\\">+</span>\\n      <span class=\\\"token string\\\">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class=\\\"token punctuation\\\">,</span>\\n      vm\\n    <span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// proxy data on instance</span>\\n  <span class=\\\"token keyword\\\">const</span> keys <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">keys</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">const</span> props <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options<span class=\\\"token punctuation\\\">.</span>props\\n  <span class=\\\"token keyword\\\">let</span> i <span class=\\\"token operator\\\">=</span> keys<span class=\\\"token punctuation\\\">.</span>length\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span>i<span class=\\\"token operator\\\">--</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>props <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">hasOwn</span><span class=\\\"token punctuation\\\">(</span>props<span class=\\\"token punctuation\\\">,</span> keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">NODE_ENV</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">'production'</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">warn</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">The data property \\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\" is already declared as a prop. </span><span class=\\\"token template-punctuation string\\\">`</span></span> <span class=\\\"token operator\\\">+</span>\\n        <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Use prop default value instead.</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n        vm\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isReserved</span><span class=\\\"token punctuation\\\">(</span>keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">proxy</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">_data</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// observe data</span>\\n  <span class=\\\"token function\\\">observe</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token comment\\\">/* asRootData */</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>proxy 方法主要通过 Object.defineProperty 的 getter 和 setter 方法实现了代理。</p>\\n<p>在 initData 方法的最后，我们调用了 observe(data, this) 方法来对 data 做监听。observe 方法的源码定义如下：</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">/**\\n * Attempt to create an observer instance for a value,\\n * returns the new observer if successfully observed,\\n * or the existing observer if the value already has one.\\n */</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">observe</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">value<span class=\\\"token punctuation\\\">:</span> any<span class=\\\"token punctuation\\\">,</span> asRootData<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token operator\\\">?</span>boolean</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> Observer <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">void</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isObject</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">let</span> ob<span class=\\\"token punctuation\\\">:</span> Observer <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">void</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">hasOwn</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'__ob__'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span> value<span class=\\\"token punctuation\\\">.</span>__ob__ <span class=\\\"token keyword\\\">instanceof</span> <span class=\\\"token class-name\\\">Observer</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob <span class=\\\"token operator\\\">=</span> value<span class=\\\"token punctuation\\\">.</span>__ob__\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n    observerState<span class=\\\"token punctuation\\\">.</span>shouldConvert <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isServerRendering</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token punctuation\\\">(</span>Array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isArray</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token function\\\">isPlainObject</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isExtensible</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token operator\\\">!</span>value<span class=\\\"token punctuation\\\">.</span>_isVue\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Observer</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>asRootData <span class=\\\"token operator\\\">&amp;&amp;</span> ob<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob<span class=\\\"token punctuation\\\">.</span>vmCount<span class=\\\"token operator\\\">++</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">return</span> ob\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<h3>参考文献</h3>\\n<p><a href=\\\"https://www.qcloud.com/community/article/914746001486266056\\\">Vue.js 2.0源码解析之前端渲染篇</a></p>\",\"frontmatter\":{\"title\":\"Vue 2.3 源码笔记\",\"date\":\"June 08, 2017\"}}},\"pathContext\":{\"slug\":\"/older/2017-06-08/\",\"previous\":{\"fields\":{\"slug\":\"/older/2017-06-07/\"},\"frontmatter\":{\"title\":\"NPM相关\"}},\"next\":{\"fields\":{\"slug\":\"/older/2017-06-12/\"},\"frontmatter\":{\"title\":\"JavaScript细节\"}}}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---older-2017-06-08-86425cb3bc5e16f3df36.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"DeepCold Blog\",\"author\":\"DeepCold\"}},\"markdownRemark\":{\"id\":\"/Users/80253170/iserver/deepcoldy.github.io/src/pages/older/2017-06-08.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>本文章只针对Vue2.3版本，后续源码和api都可能产生变化，阅读时请因地制宜。</p>\\n<h2>入口文件</h2>\\n<p>Vue 2.3的入口文件叫做runtime-with-compiler.js (此文件名可能会随着版本变化)</p>\\n<p><img src=\\\"https://raw.githubusercontent.com/deepcoldy/pic/master/20190727231750.png\\\"></p>\\n<h3>流程图</h3>\\n<p><img src=\\\"https://raw.githubusercontent.com/deepcoldy/pic/master/20190727231804.png\\\"></p>\\n<h3>文件关联</h3>\\n<p><code class=\\\"language-text\\\">src/core/instance/init.js</code> 引入 <code class=\\\"language-text\\\">src/core/instance/inject.js</code>  引入 <code class=\\\"language-text\\\">src/core/observer/index.js</code>\\nobserver的index.js\\n<code class=\\\"language-text\\\">src/core/instance/index.js</code> 和 <code class=\\\"language-text\\\">src/core/instance/init.js</code> 都引入了 <code class=\\\"language-text\\\">src/core/instance/state.js</code>。\\nstate.js是给 data 对象添加 Observer 的。\\n<code class=\\\"language-text\\\">src/core/instance/init.js</code> 中调用了 state.js 的 initState 方法</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// src/core/instance/init.js</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">initState</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">vm<span class=\\\"token punctuation\\\">:</span> Component</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  vm<span class=\\\"token punctuation\\\">.</span>_watchers <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token keyword\\\">const</span> opts <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initProps</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>methods<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initMethods</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>methods<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">initData</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">)</span>  <span class=\\\"token comment\\\">// 给 data 对象添加 Observer </span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">observe</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">.</span>_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token comment\\\">/* asRootData */</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>computed<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initComputed</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>computed<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>opts<span class=\\\"token punctuation\\\">.</span>watch<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token function\\\">initWatch</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> opts<span class=\\\"token punctuation\\\">.</span>watch<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>最重要的就是initDate()的方法</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// src/core/instance/init.js</span>\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">initData</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">vm<span class=\\\"token punctuation\\\">:</span> Component</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> data <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options<span class=\\\"token punctuation\\\">.</span>data\\n  data <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>_data <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">typeof</span> data <span class=\\\"token operator\\\">===</span> <span class=\\\"token string\\\">'function'</span>\\n    <span class=\\\"token operator\\\">?</span> <span class=\\\"token function\\\">getData</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">,</span> vm<span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">:</span> data <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isPlainObject</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n    process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">NODE_ENV</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">'production'</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">warn</span><span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">'data functions should return an object:\\\\n'</span> <span class=\\\"token operator\\\">+</span>\\n      <span class=\\\"token string\\\">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class=\\\"token punctuation\\\">,</span>\\n      vm\\n    <span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// proxy data on instance</span>\\n  <span class=\\\"token keyword\\\">const</span> keys <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">keys</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">const</span> props <span class=\\\"token operator\\\">=</span> vm<span class=\\\"token punctuation\\\">.</span>$options<span class=\\\"token punctuation\\\">.</span>props\\n  <span class=\\\"token keyword\\\">let</span> i <span class=\\\"token operator\\\">=</span> keys<span class=\\\"token punctuation\\\">.</span>length\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span>i<span class=\\\"token operator\\\">--</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>props <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">hasOwn</span><span class=\\\"token punctuation\\\">(</span>props<span class=\\\"token punctuation\\\">,</span> keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">NODE_ENV</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">'production'</span> <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">warn</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">The data property \\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\" is already declared as a prop. </span><span class=\\\"token template-punctuation string\\\">`</span></span> <span class=\\\"token operator\\\">+</span>\\n        <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Use prop default value instead.</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n        vm\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isReserved</span><span class=\\\"token punctuation\\\">(</span>keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">proxy</span><span class=\\\"token punctuation\\\">(</span>vm<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">_data</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> keys<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// observe data</span>\\n  <span class=\\\"token function\\\">observe</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token comment\\\">/* asRootData */</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>proxy 方法主要通过 Object.defineProperty 的 getter 和 setter 方法实现了代理。</p>\\n<p>在 initData 方法的最后，我们调用了 observe(data, this) 方法来对 data 做监听。observe 方法的源码定义如下：</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">/**\\n * Attempt to create an observer instance for a value,\\n * returns the new observer if successfully observed,\\n * or the existing observer if the value already has one.\\n */</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">observe</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">value<span class=\\\"token punctuation\\\">:</span> any<span class=\\\"token punctuation\\\">,</span> asRootData<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token operator\\\">?</span>boolean</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> Observer <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">void</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isObject</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">let</span> ob<span class=\\\"token punctuation\\\">:</span> Observer <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">void</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">hasOwn</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'__ob__'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span> value<span class=\\\"token punctuation\\\">.</span>__ob__ <span class=\\\"token keyword\\\">instanceof</span> <span class=\\\"token class-name\\\">Observer</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob <span class=\\\"token operator\\\">=</span> value<span class=\\\"token punctuation\\\">.</span>__ob__\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n    observerState<span class=\\\"token punctuation\\\">.</span>shouldConvert <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token operator\\\">!</span><span class=\\\"token function\\\">isServerRendering</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token punctuation\\\">(</span>Array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isArray</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token function\\\">isPlainObject</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isExtensible</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&amp;&amp;</span>\\n    <span class=\\\"token operator\\\">!</span>value<span class=\\\"token punctuation\\\">.</span>_isVue\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Observer</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>asRootData <span class=\\\"token operator\\\">&amp;&amp;</span> ob<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ob<span class=\\\"token punctuation\\\">.</span>vmCount<span class=\\\"token operator\\\">++</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">return</span> ob\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<h3>参考文献</h3>\\n<p><a href=\\\"https://www.qcloud.com/community/article/914746001486266056\\\">Vue.js 2.0源码解析之前端渲染篇</a></p>\",\"frontmatter\":{\"title\":\"Vue 2.3 源码笔记\",\"date\":\"June 08, 2017\"}}},\"pathContext\":{\"slug\":\"/older/2017-06-08/\",\"previous\":{\"fields\":{\"slug\":\"/older/2017-06-07/\"},\"frontmatter\":{\"title\":\"NPM相关\"}},\"next\":{\"fields\":{\"slug\":\"/older/2017-06-12/\"},\"frontmatter\":{\"title\":\"JavaScript细节\"}}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/older-2017-06-08.json\n// module id = 463\n// module chunks = 139262494466065"],"sourceRoot":""}