---
date: 2018-10-02
status: public
title: Vue的响应式系统
---


## Object.defineProperty

```js
Object.defineProperty(obj, prop, descriptor)
```

descriptor的属性如下

- enumerable，属性是否可枚举，默认 false。
- configurable，属性是否可以被修改或者删除，默认 false。
- get，获取属性的方法。
- set，设置属性的方法。

## observer

observer接收需要响应化的对象，通过遍历所有属性的方式对该对象的每一个属性都通过 defineReactive 处理。

```js
function observer (value) {
    if (!value || (typeof value !== 'object')) {
        return;
    }
    const keys = Object.keys(obj)
    for (let i = 0; i < keys.length; i++) {
      defineReactive(obj, keys[i])
    }
    Object.keys(value).forEach((key) => {
        defineReactive(value, key, value[key]); // 会递归
    });
}
```

defineReactive定义后，在取obj的key值时会触发reactiveGetter方法，而在该属性被修改时会触发reactiveSetter方法

```js
function defineReactive (obj, key, val) {
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: true,
    get: function reactiveGetter () {
      // 依赖收集
    },
    set: function reactiveSetter (newVal) {
      if (newVal === value || (newVal !== newVal && value !== value)) {
        return
      }
      // 视图更新
    }
  });
}
```

## 响应式的最终封装

options.data即vue组件中的data

```js
class Vue {
    /* Vue构造类 */
    constructor(options) {
        this._data = options.data;
        observer(this._data);
    }
}
```

