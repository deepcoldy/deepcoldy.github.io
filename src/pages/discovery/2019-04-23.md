---
date: 2019-04-23
status: public
title: React Native 点9图方案
---

搜了全网，解决方案很少。
只找到了[react-native-image-capinsets](https://github.com/madsleejensen/react-native-image-capinsets)这个组件。

还有一篇文章[React Native显示点9图片](https://www.jianshu.com/p/1f3ab1caee97)

但是文章介绍的不是很详细，我来把关键步骤解释一下。

`
capInsets={{top: 40, left: 29, bottom: 9, right: 29}}
`

这里的top: 是左边黑块距离顶部的y轴距离(px)
left：是顶部黑块距离左边的x轴距离(px)
bottom：图片宽度 - 底部黑块宽度
right：图片高度 - 右边黑款高度

设置好后，在debug模式确实能看到效果，我用点9图的意义在于设置图片阴影。

但是仍存在黑边，如下图：

![](https://raw.githubusercontent.com/deepcoldy/pic/master/20190727230645.png)

黑边出现的原因有三种：
1. 因为在React Native代码中无法引入xxx.9.png的图片。只能引入xxx.png这种格式。（没时间验证，存疑）
2. 生成点9图的方式不正确。我是在Android Studio里面生成的。生成方式是把普通后缀的图片放进去（如xxx.png），然后点`Create 9-patch file`然后就会生成一个xxx.9.png格式的图片。接着放到Android Studio里面打开就能拖动形成点9图的黑边了。
3. 图片生成错误：例如黑边不是紧贴着图片最外层。

除此之外，上图是模拟器和真机debug包的效果，下图是真机release包的效果：

![](https://raw.githubusercontent.com/deepcoldy/pic/master/20190727230742.png)

可以看到，在真机上的release包，点9图完全没有生效，只是做了一个普通的拉伸而已，没有做特定位置的拉伸。

这里特殊说明一下我的设计图解决方案是px转真机dp。

```js
// util.js
import { Dimensions } from 'react-native';
 
// 设备宽度，单位 dp
const deviceWidthDp = Dimensions.get('window').width;
 
// 设计稿宽度（这里为640px），单位 px
const uiWidthPx = 1080;

// px 转 dp（设计稿中的 px 转 rn 中的 dp）
export const px = (uiElePx) => {
  return uiElePx * deviceWidthDp / uiWidthPx;
}
```

在模拟器上可生效的数值是用px转dp的方案。

所以我怀疑是我的`capInsets={}`设置错误了，果然我改了一次参数之后，直接用px去写，果然可以在真机上可以拉伸了。但是真机上可以拉伸以后，模拟器上又不拉伸了。

问了一下头条的RN开发：

![](https://raw.githubusercontent.com/deepcoldy/pic/master/20190727230442.png)

遂放弃该方案。

此处记录了2019年4月的React Native现状，在没有更好方案出现之前，建议不要在React Native上使用Point 9 Image。

