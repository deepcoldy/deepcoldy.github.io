---
date: 2018-05-25
status: public
title: Typescript在React的Hooks中该如何定义动态渲染元素
---

在React中写Typescript有很多奇技淫巧，下面来介绍一个在实际工作中遇到的真实场景。

其中用到了Typescript的泛型和Infer。

这是一个简单的demo，目的是渲染一个列表出来。

目前给`List`组件传入了`dataSource`和`renderItem`。


```js
function demo() {
  const dataSource = [{a: '1',},{b: '2',},{v: '3',}];

  return (
    <List
      dataSource={dataSource}
      renderItem={data => {
        const { a, b, c } = data;
        return (
          <div>{a || b ||c}</div>
        );
      }}
    />
  );
}

```
如何定义`List`组件？
如下：

```js
function List<T>(props: IListProps<T>) { // 可见这里的泛型没有实际使用，但一定要传，原因往下看。
  const { dataSource, renderItem, ...passProps } = props;

  return (
    <ListContainer {...passProps}>
      {dataSource.map(
        (item): React.ReactElement => {
          const node = renderItem(item);
          return React.cloneElement(node, {
            key: node.key,
          });
        }
      )}
    </ListContainer>
  );
}
```

```js
export interface IListProps<T> {
  dataSource: dataSource<T>[]; // 数组
  renderItem: renderItem<T>; // 重点
  size?: ListSize;
  border?: boolean;
}
type dataSource<T> = T; // 传入什么类型 即什么类型
type renderItem<T> = (
  item: ArrayElement<dataSource<T>[]>,
  i: number
) => React.ReactElement;
export type ArrayElement<T> = T extends (infer P)[] ? P : never; // 获取传入数组的中每项value的类型
```

这样在写`renderItem`时就能获得`dataSource`中的类型提示了。


### 参考链接：
https://stackoverflow.com/questions/41253310/typescript-retrieve-element-type-information-from-array-type