---
date: 2018-09-20
status: public
title: Event Loop 小记
---

## Event Loop

- 同步任务先执行，遇到异步任务交给异步处理模块处理

- 同步任务执行完后，当异步任务达到可执行状态时，事件触发线程将回调函数加入任务队列，等待栈为空时，依次进入栈中执行。

- 先执行微任务队列里的任务。

- 微任务队列里的任务全部执行完毕后，会读取宏任务队列中拍最前的任务。

- 执行宏任务的过程中，遇到微任务，依次加入微任务队列。

### 宏任务（task）

`script(全局任务)， setTimeout， setInterval， setImmediate， I/O， UI rendering`

### 微任务（macrotask）

`process.nextTick， Promise.then()， Object.observe， MutationObserver`

## 例子

```js
console.log('1')

setTimeout(function() {
  console.log('2')

  new Promise(function(resolve) {
    console.log('3')

    resolve()
  }).then(function() {
    console.log('4')
  })
})

new Promise(function(resolve) {
  console.log('5')

  resolve()
}).then(function() {
  console.log('6')
})

setTimeout(function() {
  console.log('7')
})

setTimeout(function() {
  console.log('8')

  new Promise(function(resolve) {
    console.log('9')

    resolve()
  }).then(function() {
    console.log('10')
  })
})

new Promise(function(resolve) {
  console.log('11')

  resolve()
}).then(function() {
  console.log('12')
})

console.log('13')
```

输出为：1、5、11、13、6、12、2、3、4、7、8、9、10
