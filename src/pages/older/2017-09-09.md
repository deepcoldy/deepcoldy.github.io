---
date: 2017-09-09 21:33:12
status: public
title: 思考一个很有意思的问题——换肤
---

## 前言
问题是这样的：当有一个需求是需要在CMS里更换用户端产品的视觉颜色，也就是换一套可以自定义的皮肤，如何做才是最好的用户体验。前端框架基于Vue。
### 思路一：向Backend请求数据
换肤的方式有很多种，最先进入脑海的当然是最省事的。把颜色数据都存放在后台，然后每个用户第一次渲染的时候向后台请求这些颜色数据。
- 劣势
    1. 需要服务端渲染。如果不是服务端渲染，用户需要等待js加载完成后，接着在ajax请求后才能看到最终的界面颜色。
    2. 需要有缓存。每个用户进入页面的时候都因为皮肤请求一次数据库显然是不合适的，既然需要加缓存那么也就需要清除缓存，这个清除机制应该是在每次修改CMS配置时触发。
当然这些劣势都可以通过使用服务端渲染来解决，例如[Vue服务端渲染](https://ssr.vuejs.org/zh/)。但是如果项目不是用服务端渲染就没有解决方式吗？不是的，还有另外的思路。

### 思路二：动态Webpack打包
> 首先声明，这个思路是受王筱启发(之后有条件会将该朋友的Blog或者Github补充上)。

在CMS中配置配置颜色后，就向服务器发送一条含有相关配置信息的请求，利用脚本工具修改css后，使用Webpack重新生成一份静态文件（包括html和相应的css）。
- 需要注意的点
    1. 每次都是做新增，如果配置皮肤参数相同的则不新增。
    2. 如果版本迭代中有相关css的更新，需要将之前的所有皮肤重新打包一遍。
    3. CMS中的配置修改或新增不会立即生效，需要等待Webpack的build完成。除非已经存在相同配置的皮肤。

#### 总结
这两种只是一个思路，具体实现上我没有继续探索，我相信第一种做法会是体验最佳的，只是成本和技术上要修改的更多，毕竟Vue2.2以后服务端渲染才稳定可用。后面如果有更好的思路或是有了进一步的实践，我会继续更新。